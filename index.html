<script>
    const ADMIN_USERNAME = "Danilo";
    const ADMIN_PASSWORD = "Danilo@123";

    let users = JSON.parse(localStorage.getItem('users')) || {};
    let links = JSON.parse(localStorage.getItem('links')) || [];
    let currentUser = localStorage.getItem('currentUser') || null;
    let followedProfiles = JSON.parse(localStorage.getItem('followedProfiles')) || {}; // Novo estado para controlar se os perfis foram seguidos por usuário

    function saveDataToStorage(key, data) {
        localStorage.setItem(key, JSON.stringify(data));
    }

    function registerUser() {
        const username = document.getElementById('registerUsername').value;
        const password = document.getElementById('registerPassword').value;
        if (username && password) {
            if (users[username]) {
                alert("Usuário já existe!");
                return;
            }
            users[username] = { password, coins: 0, watchedLinks: [] };
            followedProfiles[username] = false; // Marca como não seguiu perfis
            saveDataToStorage('users', users);
            saveDataToStorage('followedProfiles', followedProfiles);
            alert('Usuário cadastrado com sucesso!');
            showFollowPage(username); // Após registro, redireciona para seguir perfis
        } else {
            alert('Por favor, preencha todos os campos.');
        }
    }

    function loginUser() {
        const username = document.getElementById('loginUsername').value;
        const password = document.getElementById('loginPassword').value;
        if (users[username] && users[username].password === password) {
            currentUser = username;
            localStorage.setItem('currentUser', currentUser);
            if (followedProfiles[username]) {
                showMainPage(); // Se já seguiu, vai para a tela principal
            } else {
                showFollowPage(username); // Se não seguiu, redireciona para seguir perfis
            }
        } else if (username === ADMIN_USERNAME && password === ADMIN_PASSWORD) {
            currentUser = username;
            localStorage.setItem('currentUser', currentUser);
            alert('Login como administrador bem-sucedido!');
            showAdminPage();
        } else {
            alert('Usuário ou senha incorretos.');
        }
    }

    function logout() {
        currentUser = null;
        localStorage.removeItem('currentUser');
        showLoginPage();
    }

    function showLoginPage() {
        document.getElementById('registerPage').classList.add('hidden');
        document.getElementById('loginPage').classList.remove('hidden');
        document.getElementById('mainPage').classList.add('hidden');
        document.getElementById('adminPage').classList.add('hidden');
        document.getElementById('followPage').classList.add('hidden');
        document.getElementById('logoutButton').classList.add('hidden');
    }

    function showRegisterPage() {
        document.getElementById('loginPage').classList.add('hidden');
        document.getElementById('registerPage').classList.remove('hidden');
    }

    function showFollowPage(username) {
        document.getElementById('loginPage').classList.add('hidden');
        document.getElementById('registerPage').classList.add('hidden');
        document.getElementById('followPage').classList.remove('hidden');
        document.getElementById('mainPage').classList.add('hidden');
        document.getElementById('adminPage').classList.add('hidden');
        document.getElementById('logoutButton').classList.add('hidden');

        // Define ação para "Já segui"
        const followedButton = document.getElementById('followedButton');
        followedButton.onclick = function () {
            followedProfiles[username] = true;
            saveDataToStorage('followedProfiles', followedProfiles);
            showMainPage();
        };
    }

    function showMainPage() {
        document.getElementById('loginPage').classList.add('hidden');
        document.getElementById('registerPage').classList.add('hidden');
        document.getElementById('followPage').classList.add('hidden');
        document.getElementById('mainPage').classList.remove('hidden');
        document.getElementById('adminPage').classList.add('hidden');
        document.getElementById('logoutButton').classList.remove('hidden');
        document.getElementById('currentUser').innerText = currentUser;
        updateCoinBalance();
    }

    function updateCoinBalance() {
        if (currentUser) {
            const userCoins = users[currentUser].coins || 0;
            document.getElementById('coinBalance').innerText = userCoins;
        }
    }

    // Inicializa a página
    if (currentUser) {
        if (followedProfiles[currentUser]) {
            showMainPage();
        } else {
            showFollowPage(currentUser);
        }
    } else {
        showLoginPage();
    }
            </script>
            
