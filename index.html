<script>
    const ADMIN_USERNAME = "Danilo";
    const ADMIN_PASSWORD = "Danilo@123";

    let users = JSON.parse(localStorage.getItem("users")) || {};
    let links = JSON.parse(localStorage.getItem("links")) || [];
    let currentUser = localStorage.getItem("currentUser") || null;

    function saveDataToStorage(key, data) {
        localStorage.setItem(key, JSON.stringify(data));
    }

    function registerUser() {
        const username = document.getElementById("registerUsername").value;
        const password = document.getElementById("registerPassword").value;

        if (username && password) {
            if (users[username]) {
                alert("Usuário já registrado!");
            } else {
                users[username] = { password, coins: 40, followed: false };
                saveDataToStorage("users", users);
                alert("Usuário registrado com sucesso!");
                showLoginPage();
            }
        } else {
            alert("Preencha todos os campos.");
        }
    }

    function loginUser() {
        const username = document.getElementById("loginUsername").value;
        const password = document.getElementById("loginPassword").value;

        if (username === ADMIN_USERNAME && password === ADMIN_PASSWORD) {
            showAdminPage();
        } else if (users[username] && users[username].password === password) {
            currentUser = username;
            localStorage.setItem("currentUser", currentUser);

            // Verifica se o usuário já seguiu os perfis
            if (!users[currentUser].followed) {
                showFollowPage();
            } else {
                showMainPage();
            }
        } else {
            alert("Usuário ou senha incorretos.");
        }
    }

    function showFollowPage() {
        document.getElementById("followPage").classList.remove("hidden");
        document.getElementById("loginPage").classList.add("hidden");
        document.getElementById("registerPage").classList.add("hidden");
        document.getElementById("mainPage").classList.add("hidden");
        document.getElementById("adminPage").classList.add("hidden");
    }

    function confirmFollow() {
        users[currentUser].followed = true;
        saveDataToStorage("users", users);
        showMainPage();
    }

    function showMainPage() {
        document.getElementById("followPage").classList.add("hidden");
        document.getElementById("loginPage").classList.add("hidden");
        document.getElementById("registerPage").classList.add("hidden");
        document.getElementById("mainPage").classList.remove("hidden");
        document.getElementById("adminPage").classList.add("hidden");

        document.getElementById("currentUser").textContent = currentUser;
        document.getElementById("coinBalance").textContent = users[currentUser].coins;
    }

    function logout() {
        currentUser = null;
        localStorage.removeItem("currentUser");
        showLoginPage();
    }

    function showLoginPage() {
        document.getElementById("loginPage").classList.remove("hidden");
        document.getElementById("registerPage").classList.add("hidden");
        document.getElementById("followPage").classList.add("hidden");
        document.getElementById("mainPage").classList.add("hidden");
        document.getElementById("adminPage").classList.add("hidden");
    }

    function showRegisterPage() {
        document.getElementById("registerPage").classList.remove("hidden");
        document.getElementById("loginPage").classList.add("hidden");
        document.getElementById("followPage").classList.add("hidden");
        document.getElementById("mainPage").classList.add("hidden");
        document.getElementById("adminPage").classList.add("hidden");
    }

    window.onload = function () {
        if (currentUser) {
            if (users[currentUser].followed) {
                showMainPage();
            } else {
                showFollowPage();
            }
        } else {
            showLoginPage();
        }
    };
</script>

<div class="container hidden" id="followPage">
    <h1>Siga esses dois perfis para continuar:</h1>
    <p><a href="https://www.tiktok.com/@mentecuriosabia?_t=ZM-8tKvX9q0CGL&_r=1" target="_blank">Perfil 1: @mentecuriosabia</a></p>
    <p><a href="https://www.tiktok.com/@thamyresp06?_t=ZM-8tAVH9k5Gh3&_r=1" target="_blank">Perfil 2: @thamyresp06</a></p>
    <button id="followedButton" onclick="confirmFollow()">Já Segui</button>
</div>

<div class="container hidden" id="loginPage">
    <h1>Login</h1>
    <input type="text" id="loginUsername" placeholder="Usuário">
    <input type="password" id="loginPassword" placeholder="Senha">
    <button onclick="loginUser()">Entrar</button>
    <button onclick="showRegisterPage()">Registrar</button>
</div>

<div class="container hidden" id="registerPage">
    <h1>Registrar</h1>
    <input type="text" id="registerUsername" placeholder="Usuário">
    <input type="password" id="registerPassword" placeholder="Senha">
    <button onclick="registerUser()">Registrar</button>
    <button onclick="showLoginPage()">Voltar</button>
</div>

<div class="container hidden" id="mainPage">
    <h1>Bem-vindo, <span id="currentUser"></span>!</h1>
    <p>Saldo de moedas: <span id="coinBalance"></span></p>
    <button onclick="logout()">Sair</button>
</div>
