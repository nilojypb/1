const users = JSON.parse(localStorage.getItem('users')) || [];
const links = JSON.parse(localStorage.getItem('links')) || [];
let currentUser = JSON.parse(localStorage.getItem('currentUser')) || null;

function switchToLogin() {
  showPage('loginPage');
}

function showPage(pageId) {
  document.querySelectorAll('.container').forEach(page => {
    page.classList.remove('active');
  });
  document.getElementById(pageId).classList.add('active');
}

function registerUser() {
  const username = document.getElementById('registerUsername').value;
  const password = document.getElementById('registerPassword').value;

  if (!username || !password) {
    alert('Preencha todos os campos!');
    return;
  }

  if (users.some(user => user.username === username)) {
    alert('Usuário já registrado!');
    return;
  }

  users.push({ username, password, balance: 0, watchedLinks: [] });
  localStorage.setItem('users', JSON.stringify(users));
  alert('Registro realizado com sucesso!');
  switchToLogin();
}

function loginUser() {
  const username = document.getElementById('loginUsername').value;
  const password = document.getElementById('loginPassword').value;

  const user = users.find(user => user.username === username && user.password === password);

  if (!user) {
    alert('Usuário ou senha inválidos!');
    return;
  }

  currentUser = user;
  localStorage.setItem('currentUser', JSON.stringify(currentUser));

  if (username === 'admin') {
    showPage('adminPage');
    loadAdminData();
  } else {
    showPage('mainPage');
    document.getElementById('usernameDisplay').textContent = username;
    document.getElementById('userBalance').textContent = user.balance;
    loadLinks();
  }
}

function logout() {
  currentUser = null;
  localStorage.removeItem('currentUser');
  switchToLogin();
}

function addTikTokLink() {
  const link = prompt('Insira o link do vídeo TikTok:');
  if (link) {
    links.push(link);
    localStorage.setItem('links', JSON.stringify(links));
    alert('Link adicionado com sucesso!');
    loadLinks();
  }
}

function watchTikTokVideo() {
  const notWatchedLinks = links.filter(link => !currentUser.watchedLinks.includes(link));
  if (notWatchedLinks.length === 0) {
    alert('Você já assistiu todos os vídeos!');
    return;
  }

  const randomLink = notWatchedLinks[Math.floor(Math.random() * notWatchedLinks.length)];
  currentUser.watchedLinks.push(randomLink);
  currentUser.balance += 10;
  localStorage.setItem('users', JSON.stringify(users));
  localStorage.setItem('currentUser', JSON.stringify(currentUser));
  document.getElementById('userBalance').textContent = currentUser.balance;

  window.open(randomLink, '_blank');
}

function loadLinks() {
  const linkList = document.getElementById('linkList');
  linkList.innerHTML = links.map(link => `<li>${link}</li>`).join('');
}

function loadAdminData() {
  const userList = document.getElementById('userList');
  userList.innerHTML = users.map(user => `
    <li>${user.username} - ${user.balance} moedas</li>
  `).join('');
}

if (currentUser) {
  if (currentUser.username === 'admin') {
    showPage('adminPage');
    loadAdminData();
  } else {
    showPage('mainPage');
    document.getElementById('usernameDisplay').textContent = currentUser.username;
    document.getElementById('userBalance').textContent = currentUser.balance;
    loadLinks();
  }
} else {
  showPage('registerPage');
    }
  
